# -*- coding: utf-8 -*-
"""download_dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1mD9zk6QnKcTUkbFvQu6RZv10wELxKhQQ
"""

!pip install Roboflow

from roboflow import Roboflow
import os
from dotenv import load_dotenv

load_dotenv()  # Load environment variables from .env file
rf = Roboflow(aapi_key=os.getenv("ROBOFLOW_API_KEY")
workspace = rf.workspace()
print(workspace)

ws = rf.workspace("trafficsignaldetection-lti5q")  # or leave blank for default
ws.list_projects()   # prints all projects in that workspace

projects = ws.projects()
print(projects)  # list of project ids like 'trafficsignaldetection-lti5q/traffic_signal_detection'

from roboflow import Roboflow

# rf = Roboflow(api_key="YOUR_API_KEY")

# Download from forked dataset
source_ws = rf.workspace("trafficsignaldetection-lti5q")
source_project = source_ws.project("traffic-signal-m5bdo-trspi")
dataset = source_project.version(1).download("yolov8")

# Now upload to your target project
target_project = source_ws.project("traffic_signal_detection")
# Use the Roboflow web UI to upload, or use the CLI command below

import os
import glob

# Assuming `dataset` and `target_project` are already defined from the previous cell

# Path to the downloaded dataset
dataset_path = dataset.location
print(f"Downloaded dataset location: {dataset_path}")

# Iterate through train, valid, test splits
splits = ['train', 'valid', 'test']

for split in splits:
    image_dir = os.path.join(dataset_path, split, 'images')
    label_dir = os.path.join(dataset_path, split, 'labels')

    if os.path.exists(image_dir) and os.path.exists(label_dir):
        print(f"\nUploading images for split: {split}")
        # Get all image files (e.g., .jpg, .png)
        image_files = glob.glob(os.path.join(image_dir, '*'))

        for image_path in image_files:
            file_name_without_ext = os.path.splitext(os.path.basename(image_path))[0]
            annotation_path = os.path.join(label_dir, f"{file_name_without_ext}.txt")

            if os.path.exists(annotation_path):
                # print(f"Uploading image: {os.path.basename(image_path)} with annotation: {os.path.basename(annotation_path)}")
                target_project.upload(image_path=image_path, annotation_path=annotation_path, split=split, model_format="yolov8")
            else:
                print(f"Warning: Annotation not found for image: {os.path.basename(image_path)}. Uploading image only.")
                target_project.upload(image_path=image_path, split=split, model_format="yolov8")
    else:
        print(f"No {split} split found at {image_dir} or {label_dir}. Skipping.")

print("\nUpload process completed.")

from roboflow import Roboflow

rf = Roboflow(api_key="38Bb4xtLGTD5P5vdhm6M")
project = rf.workspace("trafficsignaldetection-lti5q").project("traffic_signal_detection")

# List all available versions for the project
available_versions = project.versions()
print("Available versions:")
for version in available_versions:
    print(f"- Version {version.version} (name: {version.name})")

project = rf.workspace("trafficsignaldetection-lti5q").project("traffic_signal_detection")

dataset = project.version(1).download("yolov8")